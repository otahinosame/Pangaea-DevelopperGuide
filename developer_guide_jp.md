# Pangaea 開発者向けガイド 1.0

- [Pangaea 開発者向けガイド 1.0](#pangaea-開発者向けガイド-10)
  - [はじめに](#はじめに)
  - [コンセプト](#コンセプト)
  - [どんな変更や拡張ができるのか?](#どんな変更や拡張ができるのか)
  - [コンセプト実現の手段](#コンセプト実現の手段)
  - [Example 1： 4キーに減らした Thumb モジュールを作る](#example-1-4キーに減らした-thumb-モジュールを作る)
    - [完成のイメージ](#完成のイメージ)
    - [修正方針](#修正方針)
    - [KiCADでの修正](#kicadでの修正)
    - [PCB発注](#pcb発注)
    - [完成形](#完成形)
  - [Example 2： カーソルキーを足した Thumb モジュールを作る](#example-2-カーソルキーを足した-thumb-モジュールを作る)
    - [ターゲット](#ターゲット)
    - [修正方針](#修正方針-1)
    - [KiCAD での修正](#kicad-での修正)
    - [QMK用firmwareの修正](#qmk用firmwareの修正)
    - [完成形](#完成形-1)
  - [Example ３： 一部のキーサイズを大きくした Thumb モジュールを作る](#example-３-一部のキーサイズを大きくした-thumb-モジュールを作る)
    - [ターゲット](#ターゲット-1)
    - [修正方針](#修正方針-2)
    - [KiCAD での修正](#kicad-での修正-1)
    - [完成形](#完成形-2)

## はじめに

この文章は Panagea Keyboard の拡張可能な仕組みを利用して自分の好きなように親指や小指の部品を作る方法を紹介します。Pangaeaでは親指モジュールは標準で5キーが用意されており、位置を調整することができるだけではなく、PCBを加工することで4キーや3キーに削減することができます。しかし加工カット自体が面倒ですし、加工時に怪我しやすいです。また親指で大きなキーを押したい、具体的には文字と同じサイズの 1u ではなくて、倍の2uやちょっと大きい1.5uを使いたいという要望には答えることができません。そこでここでは親指の部品を修正する方法をご紹介します。

ことわざで「弘法筆を選ばす」と言われるように書に優れている者なら筆の善し悪しは関係なく、つまり技量が優れていれば道具に左右されないという見方もありますが、そもそも手の大きさや動く範囲は人それぞれなので筆一本の世界とは異なると思います。すなわち、ここでは人が道具であるキーボードを修正するアプローチをとります。

## コンセプト

[White Paper](whitepaper_jp.md) で実現したい世界が説明されているように Panagaea Keyboard では位置を調整することができるだけではなく、好きな部品を組み合わせて利用したり、PCB を切断することでキーの数を調整したりすることもできます。欲しい部品がなければ共通部分を再設計することなく、必要な部分のみを設計し最小の工数で自分好みの keyboard を作ることができます。

## どんな変更や拡張ができるのか?

例えば次のような部品の変更や拡張が考えられます。
まずは RI では、標準レイアウトからの小変更では、ロータリエンコードの省略、ロータリーエンコーダの隣のキーを削除できます。また大きな変更では数字行を省いたコンパクトなものも基板の加工により対応できます。親指モジュールと小指モジュールを省いたメイン基板だけのマクロパッド的なものも作れます。
この標準レイアウトに加えて、ファンクションキーや Joy Stick などの拡張部品も作れるわけです。
仕様に準拠して互換性を考慮した作りをすることで、新しい部分に集中できて開発の効率がよくなります。
![Expandability](images/2022-12-11_11_33_55.png "Expandability")

## コンセプト実現の手段

このコンセプトを実現するために Specification が定義されており、それに準拠した実装の例として Reference Implementaion (RI) があります。それが Pangaea V1.2 です。

まず Pangaea RI 1.2でできるカスタマイズの一覧です。
![Use Case](images/2022-12-11_21_12_12.png)

これで満足できず、新たな部品を作りたい方向けにここから詳しく説明します。
この RI の KiCAD による親指モジュールなどの設計ファイルは MITライセンスで配布されているため拡張部品を自由に開発し頒布や販売ができます。

各文章の位置づけは次の図のようになります。
White Paper では実現したい世界としてのコンセプトを描いています。Use Case ではコンセプトに沿って具体的にどんなオプションパーツを作るのかを決めています。Specification では後方互換性を維持するためにメカや電気信号の規定がされています。そして、本稿 Developer Guide では拡張部品を開発してみようという方向けに互換性を維持しつつ、必要なところだけを開発できる仕組みをご紹介します。

![文書の位置付け](images/2022-12-11_11_23_14.png "Figure 1: 文書の位置付け")

モジュール間の接続や交換を簡単にするためにモジュール間の接続に JST 社の SH コネクタを採用していますAdafruit 社の Qwicc システムでも利用されてコネクタで、さまざまな長さのケーブルを入手することができます。日本では秋月電子さんにリクエストしたら取り扱いを開始してくれています。

JST SHコネクタ
<img src="images/2022-12-26_21_19_15.png" width="50%">


## Example 1： 4キーに減らした Thumb モジュールを作る

標準では 1u サイズのキーが5つ並んでおり、切断すれば4キー、あるいは3キーまで数を減らすことができます。しかしながらPCBの切断自体が面倒であり、RIは汎用性を持たせて設計しているため、切断するとネジ止めができなくなり少々強度が落ちます。ここでは専用部品としてキーの数を標準の5つから４つに減らした版を作ってみます。
個人的には左は5つほしいですが右は4つでいいし、5つあるとむしろ利用しないキーが指にあたり邪魔に感じます。

### 完成のイメージ

図のような完成を目指します。Lower, Raiseの2つのキーとEnter部分に1.5uのサイズのキーを使えるように修正します。余談ですがもともとPangaeaを開発する前このような親指の一部のキーのサイズが大きいキーボードを利用していました。このような拡張ができることを想定して開発しています。

図の左が標準で、右の図が作ろうとしているものです。

<img src="images/2022-12-11_12_28_00.png" width="80%">

### 修正方針

配線とキーレイアウトの仕様はスペックで規定されています。ねじ穴は規定されておらず、RI 1.2の実装としてこのサイズになっています。今回はキーを削るだけですので特にスペックを見て確認するところはなく互換性の問題も生じません。

ここでは単純にキーを減らすだけですので次の方針で進めます。

* 親指部品の外形をできるだけ再利用し、キーを減らした枠を作る
* 親指部品の配線を再利用し、削減したキーのところだけ削除する
* 親指部品の2つのねじ穴を修正せず再利用する

### KiCADでの修正

大きく3つの変更で対応します。
トッププレート、PCB、ボトムプレートの3つを修正する必要があります。

変更する前の部品です。
TODO: Insert 親指部品

1. KiCAD PCB editor にて一番右端のキーの footprint を削除
2. 続いて、一番右のキーに関連する配線を削除
3. ねじを利用するように edge の外形のデザインを変更

これで Gerberファイルを出力して基板を製造すれば、手間暇をかけて基板を切断したりする必要がなくなります。

### PCB発注

KiCADでGerberを生成し、お好きな基板製造会社に発注し、届くのを待ちます。

### 完成形

ここまでは簡単です。SHコネクタで接続して動作を確認します。
キーを一つ削っただけですのでソフトウェアの変更は不要です。

![完成形PCB](images/2022-12-11_11_41_43.png)

## Example 2： カーソルキーを足した Thumb モジュールを作る

次はキーを削るのではなくてキーを足す例を紹介します。
### ターゲット

### 修正方針

### KiCAD での修正

### QMK用firmwareの修正
### 完成形

## Example ３： 一部のキーサイズを大きくした Thumb モジュールを作る

次はキーの削除といった簡単なものではなくて、キーのサイズを1uから少し大きくしてみます。

### ターゲット

できあがりのイメージです。
まず5つのキーから4つに減らします。そして、左から二番目のキーのサイズを1uから1.5uに変更します。

![current_vs_goal](images/2022-12-11_11_42_54.png)

### 修正方針

まず1.5uにするには、キーの1.5uのfootprintが必要です。
さらに外形も配線も大きな修正が必要になります。

### KiCAD での修正

### 完成形

